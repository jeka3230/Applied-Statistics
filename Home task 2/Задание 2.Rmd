---
title: "Краш-тест с манекенами"
author: "Евгений Смирнов"
date: "April 14, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Имеются результаты 352 краш-тестов, при которых происходило лобовое столкновение автомобилей с бетонной стеной на скорости около 60 км/ч. Измерены показатели повреждения манекенов: критерий тяжести повреждений головы, замедление грудной клетки, нагрузка на левое и правое бедро.
Требуется исследовать зависимость показателей повреждения от типа кузова, вида средств защиты, места манекена.

Считаем данные и удалим пропуски. Пропуски составляют чуть более 3% от выборки.

- head - Критерий тяжести повреждений головы (HIC)
- chest - Замедление грудной клетки
- left - Нагрузка на левое бедро
- right - Нагрузка на правое бедро
- place - Место
- remedy - Средство защиты
- body - Тип кузова

```{r, cache=TRUE}
data <- read.csv("crush.csv", header = T, )[c(3,4,5,6,7,8,12)]

colnames(data) <- c("head", "chest", "left","right","place","remedy", "body")
#data <- subset(data, remedy != "Подушка безопасности у водителя  и пассажира")
for (k in 5:7) {
  data[k] <- factor(sapply(data[k], as.character))
}
data1 <- data[c(1,5:7)]
data1 <- data1[data1$head != "nd",]
data1$head <- as.numeric(as.vector(data1$head))
data2 <- data[c(2,5:7)]
data2 <- data2[data2$chest != "nd",]
data2$chest <- as.numeric(as.vector(data2$chest))
data3 <- data[c(3,5:7)]
data3 <- data3[data3$left != "nd",]
data3$left <- as.numeric(as.vector(data3$left))
data4 <- data[c(4,5:7)]
data4 <- data4[data4$right != "nd",]
data4$right <- as.numeric(as.vector(data4$right))
str(data1)
```

```{r}
a1 <- aov(head ~ place*remedy*body, data=data1)
a2 <- aov(chest ~ place*remedy*body, data=data2)
a3 <- aov(left ~ place*remedy*body, data=data3)
a4 <- aov(right ~ place*remedy*body, data=data4)
```

##Критерий тяжести повреждений головы (HIC)
```{r}
summary(a1)
```


```{r}
library(DescTools)
EtaSq(a1, type=1)
```

```{r}
with(data1[data1$place == "Водитель", ],  interaction.plot(body, remedy, head, 
                                                      main = "Место манекена - Водитель"))
```

```{r}
with(data1[data1$place == "Пассажир", ],  interaction.plot(body, remedy, head, 
                                                      main = "Место манекена - Пассажир"))
```

Есть межфакторное взаимодействие place-body.
Разделим выборку по этой паре.


```{r}
a11 <- aov(head ~ remedy*body , data = subset(data1, place == "Водитель"))
summary(a11)
```

```{r}
EtaSq(a11, type=1)
```

```{r}
TukeyHSD(a11, which="remedy")
```

Критерий тяжести повреждения головы, манекен сидит на месте водителя выше при ручном ремне безопасности по сравнению с моторизорованным ремнём в среднем на 300, при пассивном по сравнению с подушкой безопасности у водителя на 300 в среднем, при ручном ремне по сравнению с подушкой безопасности у водителя и пассажира на 550 в среднем.  

```{r}
TukeyHSD(a11, which="body")
```

Критерий тяжести повреждения головы, манекен сидит на месте водителя выше в автомобилях с типом кузова "van", чем у типов кузова "comp" и "lt" в среднем на 400.


```{r}
a12 <- aov(head ~ remedy*body , data = subset(data1, place == "Пассажир"))
summary(a12)
```

```{r}
EtaSq(a12, type=1)
```

```{r}
TukeyHSD(a12, which="remedy")
```

Критерий тяжести повреждения головы, манекен сидит на месте пассажира значительно не отличается для всех средств защиты.

```{r}
TukeyHSD(a12, which="body")
```

Критерий тяжести повреждения головы, манекен сидит на месте пассажира выше в автомобилях с типом кузова "mpv", чем у типов кузова "comp", "lt", "med", "pu" в среднем на 500 и "mini" на 600.

##Замедление грудной клетки
```{r}
summary(a2)
```
Межфакторное взаимодействие не значимо.
```{r}
EtaSq(a2, type=1)
```

```{r}
TukeyHSD(a2, which="place")
```
Замедление грудной клетки у пассажира ниже, чем у водителя на примерно на 6. 

```{r}
TukeyHSD(a2, which="body")
```
Замедление грудной клетки для типа кузова "mpv" выше, чем при использовании типов "comp","lt","med","mini", "pu" в среднем на 8, у типа кузова "van" выше чем у "comp","lt", "mini" в среднем на 10.

Двухфакторное взаимодействие значимо, поэтому разделим выборку по фактору body.

```{r}
TukeyHSD(a2, which="remedy")
```

Замедление грудной клетки повышается при использовании ручного ремня безопасности по сравнению с подушкой безопасности у водителя.

##Нагрузка на левое бедро
```{r}
summary(a3)
```
Межфакторное взаимодействие не значимо.
```{r}
EtaSq(a3, type=1)
```

```{r}
TukeyHSD(a3, which="remedy")
```
Нагрузка на левое бедро снижается при использовании ручного ремня по сравнению с моторизированным и пассивным в среднем на 300. 
```{r}
TukeyHSD(a3, which="body")
```

Нагрузка на левое бедро выше для типа кузова "van" по сравнению со всеми остальными в среднем на 500.

##Нагрузка на правое бедро
```{r}
summary(a4)
```
Межфакторное взаимодействие не значимо.
```{r}
EtaSq(a4, type=1)
```

```{r}
TukeyHSD(a4, which="remedy")
```
Нагрузка на правое бедро при использовании моторизированного ремня выше чем при использовании подушки безопасности для водителя и ручного ремня безопасности в среднем на 400. Ручной ремень безопасности снижает нагрузку в среднем на 300 по сравнению с пассивным ремнём.
```{r}
TukeyHSD(a4, which="place")
```
Нагрузка на правое бедро выше у водителя в среднем на 120.


